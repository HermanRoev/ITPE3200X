@model ITPE3200X.ViewModels.PostViewModel

<div class="row justify-content-center mb-3">
    <div class="card col-md-6 mt-3" style="background-color: rgba(124,190,234,0.08)">
        <!-- Post Container -->
        <div class="post-container mt-3 mb-3">
            <!-- Carousel -->
            <!-- Triple-dot Dropdown Menu -->
            @if (Model.IsOwnedByCurrentUser)
            {
                <div class="dropdown post-options">
                    <button class="btn btn-link text-white p-0 m-0" type="button" id="postOptionsMenu-@Model.PostId" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="postOptionsMenu-@Model.PostId">
                        <li>
                            <a class="dropdown-item d-flex align-items-center" asp-controller="Home" asp-action="" asp-route-postId="@Model.PostId">
                                <i class="bi bi-pencil me-2"></i> Edit
                            </a>
                        </li>
                        <li>
                            <form asp-action="DeletePost" asp-controller="Home" asp-route-postId="@Model.PostId" asp-route-homefeed="@Model.HomeFeed" method="post" onsubmit="return confirm('Are you sure you want to delete this post?');">
                                <button type="submit" class="dropdown-item d-flex align-items-center">
                                    <i class="bi bi-trash me-2 text-danger"></i> Delete
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            }
            <div id="carouselPostImages-@Model.PostId" class="carousel slide">
                <!-- Indicators -->
                @if (Model.Images.Count > 1)
                {
                    <div class="carousel-indicators" style="position: absolute; top: 10px;">
                        @for (int i = 0; i < Model.Images.Count; i++)
                        {
                            <button type="button" data-bs-target="#carouselPostImages-@Model.PostId" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")" aria-label="Slide @(i + 1)"></button>
                        }
                    </div>
                }

                <!-- Images -->
                <div class="carousel-inner">
                    @for (int i = 0; i < Model.Images.Count; i++)
                    {
                        var image = Model.Images.ElementAt(i);
                        <div class="carousel-item @(i == 0 ? "active" : "")"> <!-- Need some way to set the post height to something constant -->
                            <img src="@image.ImageUrl" class="d-block w-100" alt="Post Image" style="width: 100%; aspect-ratio: 3/4; object-fit: contain; background-color: black;">
                        </div>
                    }
                </div>

                <!-- Controls -->
                @if (Model.Images.Count > 1)
                {
                    <button class="carousel-control-prev carousel-control-prev-icon" style="top: 50%;" aria-hidden="true" type="button" data-bs-target="#carouselPostImages-@Model.PostId" data-bs-slide="prev"></button>
                    <button class="carousel-control-next carousel-control-next-icon" style="top: 50%;" aria-hidden="true" type="button" data-bs-target="#carouselPostImages-@Model.PostId" data-bs-slide="next"></button>
                }
            </div>

            <!-- Overlay Elements -->
            <div class="overlay-elements">
                <!-- Profile Picture and Account Name -->
                <div class="profile-info d-flex align-items-center">
                    <a class="nav-link" style="padding: 0;" asp-controller="Profile" asp-action="Profile" asp-route-username="@Model.UserName">
                        @if (string.IsNullOrEmpty(Model.ProfilePicture))
                        {
                            <i class="bi bi-person-circle" style="font-size: 2rem; color: #7cbeea;"></i> <!-- Default Profile Picture, needs css fix -->
                            <span class="username">@Model.UserName</span>
                        }
                        else
                        {
                            <img src="@(Model.ProfilePicture)" alt="Profile Picture" class="rounded-circle profile-picture">
                            <span class="username">@Model.UserName</span>
                        }
                    </a>
                </div>

                <!-- Like and Save Icons -->
                <partial name="_LikeSavePartial" model="Model" />
            </div>
        </div>

        <!-- Content and Comments -->
        <div class="post-content mt-2 mb-3">
            <!-- Content -->
            <div>
                @if (!string.IsNullOrEmpty(Model.Content) && Model.Content.Length > 100)
                {
                    <p id="postContentShort-@Model.PostId">
                        @Model.Content.Substring(0, 100)... 
                        <a style="color: #76b5e0; cursor: pointer;" onclick="showFullContent('@Model.PostId')">Read more</a>
                    </p>
                    <p id="postContentFull-@Model.PostId" style="display: none;">
                        @Model.Content 
                        <a style="color: #76b5e0; cursor: pointer;" onclick="showShortContent('@Model.PostId')">Show less</a>
                    </p>
                }
                else
                {
                    <p>@Model.Content</p>
                }
            </div>

            <!-- Comments Section -->
            <div class="collapse" id="commentsSection-@Model.PostId">
                <partial name="_CommentsPartial" model="Model" />
            </div>
        </div>
    </div>
</div>
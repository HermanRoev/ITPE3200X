@using Microsoft.AspNetCore.Identity
@model ITPE3200X.ViewModels.PostViewModel

@inject SignInManager<ApplicationUser> SignInManager

<div id="comments-section-@Model.PostId">
    <ul class="list-group list-group-flush">
        @foreach (var comment in Model.Comments)
        {
            <li class="list-group-item d-flex justify-content-between">
                <span>
                    <strong>@comment.UserName</strong> @comment.Content
                </span>
                <span class="d-flex gap-3">
                    <small class="text-muted text-nowrap">@comment.TimeSincePosted</small>
                    @if (@comment.IsCreatedByCurrentUser)
                    {
                        <!-- Delete Button -->
                        <form asp-action="DeleteComment" asp-controller="Home" asp-route-postId="@Model.PostId" asp-route-commentId="@comment.CommentId" method="post" data-ajax="true" data-ajax-mode="replace" data-ajax-update="#comments-section-@Model.PostId">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-link p-0">
                                <i class="bi bi-trash text-danger"></i>
                            </button>
                        </form>
                    }
                </span>
            </li>
        }
    </ul>
    <!-- Add Comment Form -->
    @if (SignInManager.IsSignedIn(User))
    {
    <form asp-action="AddComment" asp-controller="Home" asp-route-postId="@Model.PostId" method="post" data-ajax="true" data-ajax-mode="replace" data-ajax-update="#comments-section-@Model.PostId" class="comment-form">
        @Html.AntiForgeryToken()
        <div class="input-group mt-3">
            <input type="text" name="Content" class="form-control bg-dark text-white border-dark" placeholder="Add a comment..." required />
            <button type="submit" class="btn loginbtn-primary">Post</button>
        </div>
    </form>
    }
    else
    {
    <div class="alert alert-info mt-3 bg-dark text-white border-0" role="alert">
        <a href="/Identity/Account/Login" style="color: #7cbeea !important;">Log in</a> to add a comment.
    </div>
    }
</div>